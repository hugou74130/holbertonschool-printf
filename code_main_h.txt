Bloc de garde

#ifndef MAIN_H

# â†’ indique une directive du prÃ©processeur.

ifndef â†’ â€œif not definedâ€ â†’ teste si le macro MAIN_H nâ€™est pas encore dÃ©fini.

MAIN_H â†’ nom du macro choisi comme identifiant unique pour ce header.

#define MAIN_H

#define â†’ crÃ©e le macro MAIN_H.

Cela active le garde : tout ce qui suit ne sera inclus quâ€™une seule fois.

Inclusions

#include <stdarg.h>

#include â†’ insÃ¨re le contenu du fichier dâ€™en-tÃªte.

<...> â†’ recherche dans les bibliothÃ¨ques systÃ¨me.

stdarg.h â†’ fournit va_list, va_start, va_arg, va_end.

#include <unistd.h>

unistd.h â†’ donne accÃ¨s Ã  write, read, etc.

UtilisÃ© pour _putchar (qui appelle write).

#include <stdlib.h>

stdlib.h â†’ fonctions utilitaires (malloc, free, exit).

#include <limits.h>

limits.h â†’ constantes comme INT_MAX, INT_MIN.

Prototypes

int _printf(const char *format, ...);

int â†’ type de retour.

_printf â†’ nom de la fonction.

(const char *format, ...) â†’ premier paramÃ¨tre : chaÃ®ne constante, puis ... = arguments variadiques.

int print_char(va_list args);

print_char â†’ fonction qui prend un va_list.

va_list â†’ type dÃ©fini dans stdarg.h.

Retourne un int (nombre de caractÃ¨res Ã©crits).

MÃªme logique pour :

int print_string(va_list args);
int print_percent(va_list args);
int print_int(va_list args);

int _putchar(char c);

_putchar â†’ imprime un seul caractÃ¨re.

ParamÃ¨tre : char c.

Retourne int (souvent 1 si succÃ¨s).

int (*get_specifier(char c))(va_list);

Prototype complexe :

get_specifier prend un char c.

Retourne un pointeur vers une fonction.

Cette fonction prend un va_list et retourne un int.

Les parenthÃ¨ses autour de *get_specifier(char c) sont obligatoires pour prÃ©ciser que câ€™est une fonction qui retourne un pointeur de fonction, pas une fonction qui retourne un int.

Structure

typedef struct specifier
{
    char c;
    int (*func)(va_list);
} specifier_t;

typedef â†’ crÃ©e un alias de type.

struct specifier { ... } â†’ dÃ©finit une structure.

char c; â†’ champ qui stocke le caractÃ¨re du spÃ©cificateur.

int (*func)(va_list); â†’ champ qui stocke un pointeur vers une fonction :

int â†’ type de retour.

(*func) â†’ func est un pointeur de fonction.

(va_list) â†’ la fonction pointÃ©e prend un va_list.

specifier_t â†’ alias du type, plus pratique Ã  utiliser.

Fin du garde

#endif

Termine le #ifndef.

Si le fichier est inclus plusieurs fois, le compilateur ignore les inclusions suivantes.

âœ¨ RÃ©sumÃ© pour ta man review

Chaque caractÃ¨re #, *, ;, {}, () a un rÃ´le prÃ©cis.

Les * entourÃ©s de parenthÃ¨ses dans int (*func)(va_list) et int (*get_specifier(char c))(va_list) sont cruciaux : ils indiquent quâ€™on manipule des pointeurs de fonctions.

Le header est bien structurÃ© : garde, includes, prototypes, typedef, fin.

### ğŸ—‚ Tableau de correspondance des spÃ©cificateurs

| caractere (c) | fonctions associÃ©es (func) | role |
| --- | --- | --- |
| â€˜dâ€™ | print_int | Affiche un entier dÃ©cimal |
| â€˜iâ€™ | print_int | Affiche un entier (identique Ã  `'d'`) |
| â€˜câ€™ | print_char | Affiche un caractÃ¨re |
| â€˜sâ€™ | print_string | Affiche une chaÃ®ne de caractÃ¨res |
| â€˜%â€™ | print_percent | Affiche le symbole `%` |
| â€˜\0â€™ | NULL | Sentinelle â†’ fin du tableau |

```c
ğŸ”— SchÃ©ma du fonctionnement
format string: "Hello %s, number: %d"

          |
          v
   get_specifier('%s')  --->  retourne pointeur vers print_string()
   get_specifier('%d')  --->  retourne pointeur vers print_int()
```

       get_specifier lit le caractÃ¨re aprÃ¨s .
â€¢ 	Cherche dans le tableau specifier_t.
â€¢ 	Retourne le pointeur de fonction correspondant.
â€¢ 	*printf appelle cette fonction avec le va_*list  pour rÃ©cupÃ©rer et afficher lâ€™argument.

âœ¨ Points clÃ©s Ã  mettre en avant en review
â€¢ 	ParenthÃ¨ses autour des pointeurs de fonction : obligatoires pour la syntaxe ( signifie â€œfunc est un pointeur vers une fonction qui prend un va_list et retourne un intâ€).
â€¢ 	Sentinelle  : Ã©vite dâ€™avoir Ã  stocker la taille du tableau.
â€¢ 	ExtensibilitÃ© : ajouter un nouveau spÃ©cificateur = ajouter une ligne dans le tableau.
â€¢ 	LisibilitÃ© : sÃ©paration claire entre caractÃ¨re et fonction.
